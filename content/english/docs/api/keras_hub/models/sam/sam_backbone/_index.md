---
title: SAMBackbone model
toc: true
weight: 2
type: docs
---

{{< keras/original checkedAt="2024-11-26" >}}

{{< keras/source link="https://github.com/keras-team/keras-hub/tree/v0.17.0/keras_hub/src/models/sam/sam_backbone.py#L7" >}}

### `SAMBackbone` class

```python
keras_hub.models.SAMBackbone(
    image_encoder, prompt_encoder, mask_decoder, dtype=None, **kwargs
)
```

A backbone for the Segment Anything Model (SAM).

**Arguments**

- **image_encoder**: [`keras_hub.models.ViTDetBackbone`]({{< relref "/docs/api/keras_hub/models/vit_det/ViTDetBackbone#vitdetbackbone-class" >}}). A feature extractor for
  the input images.
- **prompt_encoder**: [`keras_hub.layers.SAMPromptEncoder`]({{< relref "/docs/api/keras_hub/models/sam/sam_prompt_encoder#sampromptencoder-class" >}}). A Keras layer to
  compute embeddings for points, box, and mask prompt.
- **mask_decoder**: [`keras_hub.layers.SAMMaskDecoder`]({{< relref "/docs/api/keras_hub/models/sam/sam_mask_decoder#sammaskdecoder-class" >}}). A Keras layer to
  generate segmentation masks given the embeddings generated by the
  backbone and the prompt encoder.
- **dtype**: The dtype of the layer weights.

**Example**

```python
image_size=128
batch_size=2
input_data = {
    "images": np.ones(
        (batch_size, image_size, image_size, 3),
        dtype="float32",
    ),
    "points": np.ones((batch_size, 1, 2), dtype="float32"),
    "labels": np.ones((batch_size, 1), dtype="float32"),
    "boxes": np.ones((batch_size, 1, 2, 2), dtype="float32"),
    "masks": np.zeros(
        (batch_size, 0, image_size, image_size, 1)
    ),
}
image_encoder = keras_hub.models.ViTDetBackbone(
    hidden_size=16,
    num_layers=16,
    intermediate_dim=16 * 4,
    num_heads=16,
    global_attention_layer_indices=[2, 5, 8, 11],
    patch_size=16,
    num_output_channels=8,
    window_size=2,
    image_shape=(image_size, image_size, 3),
)
prompt_encoder = keras_hub.layers.SAMPromptEncoder(
    hidden_size=8,
    image_embedding_size=(8, 8),
    input_image_size=(
        image_size,
        image_size,
    ),
    mask_in_channels=16,
)
mask_decoder = keras_hub.layers.SAMMaskDecoder(
    num_layers=2,
    hidden_size=8,
    intermediate_dim=32,
    num_heads=8,
    embedding_dim=8,
    num_multimask_outputs=3,
    iou_head_depth=3,
    iou_head_hidden_dim=8,
)
backbone = keras_hub.models.SAMBackbone(
    image_encoder=image_encoder,
    prompt_encoder=prompt_encoder,
    mask_decoder=mask_decoder,
    image_shape=(image_size, image_size, 3),
)
backbone(input_data)
```

{{< keras/source link="https://github.com/keras-team/keras-hub/tree/v0.17.0/keras_hub/src/models/backbone.py#L127" >}}

### `from_preset` method

```python
SAMBackbone.from_preset(preset, load_weights=True, **kwargs)
```

Instantiate a [`keras_hub.models.Backbone`]({{< relref "/docs/api/keras_hub/base_classes/backbone#backbone-class" >}}) from a model preset.

A preset is a directory of configs, weights and other file assets used
to save and load a pre-trained model. The `preset` can be passed as a
one of:

1. a built-in preset identifier like `'bert_base_en'`
2. a Kaggle Models handle like `'kaggle://user/bert/keras/bert_base_en'`
3. a Hugging Face handle like `'hf://user/bert_base_en'`
4. a path to a local preset directory like `'./bert_base_en'`

This constructor can be called in one of two ways. Either from the base
class like `keras_hub.models.Backbone.from_preset()`, or from
a model class like `keras_hub.models.GemmaBackbone.from_preset()`.
If calling from the base class, the subclass of the returning object
will be inferred from the config in the preset directory.

For any `Backbone` subclass, you can run `cls.presets.keys()` to list
all built-in presets available on the class.

**Arguments**

- **preset**: string. A built-in preset identifier, a Kaggle Models
  handle, a Hugging Face handle, or a path to a local directory.
- **load_weights**: bool. If `True`, the weights will be loaded into the
  model architecture. If `False`, the weights will be randomly
  initialized.

**Examples**

```python
# Load a Gemma backbone with pre-trained weights.
model = keras_hub.models.Backbone.from_preset(
    "gemma_2b_en",
)
# Load a Bert backbone with a pre-trained config and random weights.
model = keras_hub.models.Backbone.from_preset(
    "bert_base_en",
    load_weights=False,
)
```

| Preset name    | Parameters | Description                                      |
| -------------- | ---------- | ------------------------------------------------ |
| sam_base_sa1b  | 93.74M     | The base SAM model trained on the SA1B dataset.  |
| sam_large_sa1b | 641.09M    | The large SAM model trained on the SA1B dataset. |
| sam_huge_sa1b  | 312.34M    | The huge SAM model trained on the SA1B dataset.  |
